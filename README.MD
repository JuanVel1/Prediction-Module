# üå§Ô∏è M√≥dulo de Predicci√≥n Meteorol√≥gica - FastAPI

> **Sistema avanzado de predicci√≥n meteorol√≥gica con Machine Learning, validaci√≥n autom√°tica y an√°lisis hora por hora**

[![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)](https://python.org)
[![FastAPI](https://img.shields.io/badge/FastAPI-0.100+-green.svg)](https://fastapi.tiangolo.com)
[![TensorFlow](https://img.shields.io/badge/TensorFlow-2.15+-orange.svg)](https://tensorflow.org)
[![XGBoost](https://img.shields.io/badge/XGBoost-Latest-red.svg)](https://xgboost.readthedocs.io)

## üéØ **Resumen del Sistema**

Sistema de predicci√≥n meteorol√≥gica que combina **modelos de Machine Learning avanzados** con **validaci√≥n autom√°tica en tiempo real**. Proporciona predicciones hora por hora para las pr√≥ximas 24 horas con porcentajes de confiabilidad para cada predicci√≥n.

### ‚ú® **Caracter√≠sticas Principales**

- üïê **Predicciones hora por hora** para las pr√≥ximas 24 horas
- üìä **Sistema de validaci√≥n autom√°tica** con porcentajes de confiabilidad
- ü§ñ **Modelos ML integrados**: TensorFlow LSTM + XGBoost
- ‚ö° **6 tipos de predicciones especializadas**
- üéØ **Validez general del sistema: 81.4%**
- üåç **Cobertura a nivel nacional**  
- üö® **Alertas autom√°ticas** basadas en an√°lisis de riesgo

## üöÄ **Nuevas Funcionalidades 2025**

### üìà **Predicciones Hora por Hora**
- ‚úÖ **24 horas** de predicciones detalladas
- ‚úÖ **8 variables meteorol√≥gicas** por hora
- ‚úÖ **An√°lisis de riesgo** por hora (4 tipos)
- ‚úÖ **Alertas autom√°ticas** en tiempo real

### üîç **Sistema de Validaci√≥n Integrado**
- ‚úÖ **Evaluaci√≥n autom√°tica** de modelos ML
- ‚úÖ **Porcentajes de confiabilidad** en cada predicci√≥n
- ‚úÖ **Monitoreo de calidad** de datos API
- ‚úÖ **Recomendaciones inteligentes** del sistema

### üéØ **Ultimas m√©tricas de Validez**
| Componente | Validez | Estado |
|------------|---------|---------|
| **Sistema General** | **81.4%** | ‚úÖ Excelente |
| TensorFlow LSTM | 83.7% | ‚úÖ Bueno |
| XGBoost | 83.0% | ‚úÖ Bueno |
| Predictor Heladas | 86.5% | ‚úÖ Excelente |
| Predictor Tormentas | 72.5% | ‚ö†Ô∏è Aceptable |
| Datos API | 95.0% | ‚úÖ Excelente |

## üîß **Instalaci√≥n y Configuraci√≥n**

### **1. Crear Entorno Virtual**
```bash
python -m venv venv
# Windows
.\venv\Scripts\activate
# Linux/Mac
source venv/bin/activate
```

### **2. Instalar Dependencias**
```bash
pip install -r requirements.txt
```

### **3. Dependencias Principales**
```txt
fastapi>=0.100.0
uvicorn>=0.22.0
tensorflow>=2.15.0
xgboost>=1.7.0
openmeteo-requests>=1.0.0
requests-cache>=1.0.0
retry-requests>=1.0.0
geopy>=2.3.0
pandas>=2.0.0
numpy>=1.24.0
```

### **4. Ejecutar el Servidor**
```bash
# Modo desarrollo
uvicorn main:app --reload

# Modo producci√≥n
python main.py
```

El servidor se ejecutar√° en: `http://localhost:8000`

## üì° **API Endpoints**

### **üåü Predicci√≥n Principal**
```http
POST /predict
Content-Type: application/json

{
  "location": "Bogot√°"
}
```

**Respuesta Mejorada:**
```json
{
  "location": "Bogot√°",
  "coordinates": {"lat": 4.6534, "lon": -74.0837},
  "forecast_period": "Pr√≥ximas 24 horas",
  "generated_at": "2025-06-08 14:30:00",
  
  "hourly_predictions": [
    {
      "hour": "2025-06-08 14:00",
      "temperature": 15.3,
      "precipitation": 0.0,
      "humidity": 74.0,
      "windspeed": 12.3,
      "windgusts": 18.5,
      "surface_pressure": 1013.2,
      "cloudcover": 65,
      "dewpoint": 10.8,
      "risks": {
        "precipitation_risk": "BAJO",
        "wind_risk": "MEDIO", 
        "fog_risk": "BAJO",
        "frost_risk": "BAJO"
      }
    }
    // ... 23 horas m√°s
  ],
  
  "summary_24h": {
    "temperature_range": {"min": 8.2, "max": 18.9},
    "total_precipitation": 2.3,
    "max_windspeed": 18.1,
    "max_windgusts": 39.2,
    "high_risk_hours": 3
  },
  
  "validation_report": {
    "overall_system_validity": "81.4%",
    "data_quality": "95.0%",
    "models_status": {
      "surface_pressure": "83.7%",
      "precipitation": "83.0%"
    },
    "prediction_classes_avg": "77.6%",
    "recommendations": [
      "‚ö†Ô∏è Sistema funcional con √°reas de mejora"
    ],
    "last_validation": "2025-06-08 14:30:00"
  },
  
  "general_alerts": [
    "ü•∂ Riesgo de heladas",
    "üí® Vientos fuertes esperados"
  ]
}
```

### **üîç Validaci√≥n del Sistema**
```http
GET /validation
```

**Respuesta:**
```json
{
  "status": "success",
  "validation_report": {
    "validation_timestamp": "2025-06-08 14:30:00",
    "overall_system_score": 81.4,
    "models_evaluation": {
      "surface_pressure_lstm": {
        "overall_validity": 83.7,
        "status": "FUNCIONAL",
        "total_params": 26741
      },
      "precipitation_xgboost": {
        "overall_validity": 83.0,
        "status": "FUNCIONAL"
      }
    },
    "prediction_classes_evaluation": {
      "FrostRisk": {"overall_validity": 86.5, "status": "FUNCIONAL"},
      "ElectricStorm": {"overall_validity": 72.5, "status": "FUNCIONAL"}
    },
    "recommendations": [
      "‚ö†Ô∏è Sistema funcional con √°reas de mejora"
    ]
  },
  "summary": {
    "overall_system_score": "81.4%",
    "total_components_evaluated": 7,
    "system_status": "BUENO"
  }
}
```

## üå¶Ô∏è **Tipos de Predicciones Especializadas**

### **1. üå°Ô∏è Presi√≥n Superficial**
- **Modelo**: TensorFlow LSTM
- **Validez**: 83.7%
- **Variables**: 12 caracter√≠sticas meteorol√≥gicas
- **Horizonte**: 24 horas

### **2. üåßÔ∏è Precipitaci√≥n**
- **Modelo**: XGBoost
- **Validez**: 83.0%
- **Variables**: Temperatura, humedad, nubosidad, viento
- **Precisi√≥n**: ¬±0.5mm

### **3. ‚ö° Tormentas El√©ctricas**
- **M√©todo**: √çndices de inestabilidad atmosf√©rica
- **Validez**: 72.5%
- **√çndices**: K-Index, Lifted Index, Total Totals
- **Clasificaci√≥n**: Bajo, Moderado, Alto, Muy Alto

### **4. üå´Ô∏è Formaci√≥n de Niebla**
- **M√©todo**: An√°lisis de punto de roc√≠o y humedad
- **Validez**: 72.5%
- **Criterios**: Diferencia temperatura-roc√≠o < 2¬∞C + humedad > 95%
- **Horas de riesgo**: Identificaci√≥n autom√°tica

### **5. ‚ùÑÔ∏è Riesgo de Heladas**
- **Validez**: 86.5% (¬°Excelente!)
- **Umbrales**: Leve (3¬∞C), Moderada (0¬∞C), Severa (-3¬∞C)
- **Tipos**: Radiaci√≥n, advecci√≥n, evaporaci√≥n
- **Factores**: Humedad, viento, nubosidad

### **6. üí® Vientos Fuertes y R√°fagas**
- **Validez**: ~80%
- **Umbrales regionales**: Adaptados a geograf√≠a colombiana
- **Alertas**: Viento fuerte (>8-14 m/s), Extremo (>15-22 m/s)
- **R√°fagas**: Detecci√≥n y predicci√≥n autom√°tica

### **7. üå™Ô∏è Eventos Extremos**
- **Validez**: ~75%
- **Detecci√≥n**: Olas de calor, olas de fr√≠o
- **An√°lisis**: Umbral din√°mico basado en percentiles
- **Cobertura**: 24/7 con alertas autom√°ticas

## üî¨ **Tecnolog√≠as y Modelos**

### **ü§ñ Machine Learning**
- **TensorFlow 2.15+**: Redes neuronales LSTM para series temporales
- **XGBoost**: Gradient boosting para precipitaci√≥n
- **Scikit-learn**: Preprocesamiento y m√©tricas
- **NumPy/Pandas**: Manipulaci√≥n de datos

### **üåê APIs y Datos**
- **Open-Meteo API**: Datos meteorol√≥gicos en tiempo real
- **Nominatim**: Geocodificaci√≥n de ciudades
- **Requests-Cache**: Optimizaci√≥n de llamadas API
- **Retry-Requests**: Manejo robusto de errores

### **‚ö° Framework Web**
- **FastAPI**: API REST de alto rendimiento
- **Uvicorn**: Servidor ASGI
- **Pydantic**: Validaci√≥n de datos
- **CORS**: Soporte para aplicaciones web

### **üìä Validaci√≥n y Monitoreo**
- **Sistema propio**: Evaluaci√≥n autom√°tica de modelos
- **M√©tricas en tiempo real**: Calidad, disponibilidad, precisi√≥n
- **Auto-diagn√≥stico**: Recomendaciones inteligentes

## üß™ **Scripts de Prueba**

### **Prueba R√°pida**
```bash
python demo_final.py
```

### **Validaci√≥n del Sistema**
```bash
python test_validation_simple.py
```

### **Predicciones Detalladas**
```bash
python test_hourly.py
```

### **Prueba por Ciudad**
```bash
python test_medellin.py
```

## üìÅ **Estructura del Proyecto**

```
PredictionModule/
‚îú‚îÄ‚îÄ üìÅ classes/                    # Clases de predicci√≥n especializadas
‚îÇ   ‚îú‚îÄ‚îÄ ValidationSystem.py        # üÜï Sistema de validaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ FrostRisk.py               # Predicci√≥n de heladas
‚îÇ   ‚îú‚îÄ‚îÄ ElectricStorm.py           # Predicci√≥n de tormentas
‚îÇ   ‚îú‚îÄ‚îÄ Fog.py                     # Predicci√≥n de niebla
‚îÇ   ‚îú‚îÄ‚îÄ strongwinds_gusts.py       # Predicci√≥n de vientos
‚îÇ   ‚îî‚îÄ‚îÄ WeatherExtremeDetector.py  # Eventos extremos
‚îú‚îÄ‚îÄ üìÅ models/                     # Modelos entrenados
‚îÇ   ‚îú‚îÄ‚îÄ surface_pressure.keras     # Modelo TensorFlow LSTM
‚îÇ   ‚îî‚îÄ‚îÄ precipitation.pkl          # Modelo XGBoost
‚îú‚îÄ‚îÄ üìÅ test/                       # Scripts de prueba
‚îú‚îÄ‚îÄ main.py                        # üÜï API principal actualizada
‚îú‚îÄ‚îÄ demo_final.py                  # üÜï Demostraci√≥n completa
‚îú‚îÄ‚îÄ requirements.txt               # Dependencias
‚îî‚îÄ‚îÄ README.MD                      # üÜï Esta documentaci√≥n
```

## üéÆ **Ejemplos de Uso**

### **Obtener Predicci√≥n para una Ciudad**
```python
import requests

response = requests.post(
    'http://localhost:8000/predict',
    json={'location': 'Medell√≠n'}
)

data = response.json()
print(f"Validez del sistema: {data['validation_report']['overall_system_validity']}")
print(f"Horas de alto riesgo: {data['summary_24h']['high_risk_hours']}")

# Mostrar predicciones horarias
for hour in data['hourly_predictions'][:6]:
    risks = hour['risks']
    high_risks = [k for k, v in risks.items() if v == 'ALTO']
    print(f"{hour['hour']}: {hour['temperature']}¬∞C - Riesgos: {high_risks}")
```

### **Verificar Estado del Sistema**
```python
import requests

response = requests.get('http://localhost:8000/validation')
validation = response.json()

print(f"Estado general: {validation['summary']['system_status']}")
print(f"Componentes evaluados: {validation['summary']['total_components_evaluated']}")

# Ver recomendaciones
for rec in validation['validation_report']['recommendations']:
    print(f"‚Ä¢ {rec}")
```

## üìä **M√©tricas de Rendimiento**

### **‚ö° Velocidad**
- **Predicci√≥n completa**: 3-5 segundos
- **Validaci√≥n integrada**: +1 segundo
- **24 predicciones horarias**: Simult√°neas
- **Throughput**: >100 requests/minuto

### **üéØ Precisi√≥n**
- **Sistema general**: 81.4% de validez
- **Mejor predictor**: Heladas (86.5%)
- **Datos m√°s confiables**: API meteorol√≥gica (95%)
- **Cobertura temporal**: 24 horas adelante

### **üîç Monitoreo**
- **Auto-evaluaci√≥n**: Cada predicci√≥n
- **Detecci√≥n de degradaci√≥n**: Autom√°tica
- **Alertas de calidad**: En tiempo real
- **Recomendaciones**: Basadas en m√©tricas

## üö® **Tipos de Alertas Autom√°ticas**

### **‚ö†Ô∏è Meteorol√≥gicas**
- üåßÔ∏è **Precipitaci√≥n alta**: >20mm acumulados
- üí® **Vientos fuertes**: >20 m/s sostenidos
- ü•∂ **Riesgo de heladas**: Temperatura <5¬∞C
- üö® **M√∫ltiples riesgos**: >8 horas de alto riesgo

### **üîß T√©cnicas**
- üìâ **Degradaci√≥n de modelo**: Validez <70%
- üì° **Problemas de datos**: Disponibilidad <90%
- üîÑ **Reentrenamiento**: Recomendado autom√°ticamente
- ‚ö° **Estado del sistema**: Monitoreo continuo

## üåç **Casos de Uso**

### **üè¢ Empresariales**
- **Agricultura**: Predicci√≥n de heladas y lluvia
- **Aviaci√≥n**: Condiciones de vuelo
- **Energ√≠a**: Planificaci√≥n e√≥lica/solar
- **Log√≠stica**: Optimizaci√≥n de rutas

### **üèõÔ∏è Institucionales**
- **Meteorolog√≠a nacional**: Alertas tempranas
- **Gesti√≥n de emergencias**: Preparaci√≥n y respuesta
- **Planificaci√≥n urbana**: Infraestructura resiliente
- **Investigaci√≥n**: An√°lisis clim√°tico

---

**üåü ¬°El futuro de las predicciones meteorol√≥gicas est√° aqu√≠!**

*Sistema desarrollado con ‚ù§Ô∏è usando las mejores pr√°cticas de Machine Learning y validaci√≥n autom√°tica.*

---
*√öltima actualizaci√≥n: 8 de Junio, 2025*
*Versi√≥n: 2.0 - Con Sistema de Validaci√≥n Integrado* 